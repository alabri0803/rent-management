{% extends 'dashboard/base.html' %}
{% load i18n %}
{% block title %}{% trans "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±" %} - {{ tenant.name }}{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.stats-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}
.stats-card:hover {
    transform: translateY(-5px);
}
.stats-number {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 5px;
}
.stats-label {
    font-size: 0.9rem;
    opacity: 0.9;
}
.chart-container {
    position: relative;
    height: 300px;
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
}
.tenant-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 20px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}
.info-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    border: 1px solid #e5e7eb;
}
.rating-stars {
    font-size: 1.5rem;
    color: #fbbf24;
}
.enhanced-table {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
}
.table-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}
.filter-section {
    background: #f8fafc;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
    border: 1px solid #e5e7eb;
}
</style>
{% endblock %}

{% block content %}
<!-- Enhanced Header -->
<div class="tenant-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-4xl font-bold mb-2">{{ tenant.name }}</h1>
            <p class="text-lg opacity-90">{{ tenant.get_tenant_type_display }} â€¢ {{ tenant.phone }}</p>
            <div class="rating-stars mt-3">
                {% for i in "12345" %}
                    {% if forloop.counter <= tenant.rating %}â˜…{% else %}â˜†{% endif %}
                {% endfor %}
                <span class="text-sm opacity-80 mr-2">({{ tenant.rating }}/5)</span>
            </div>
        </div>
        <div class="text-left">
            <a href="{% url 'tenant_update' tenant.pk %}" class="bg-white text-purple-600 py-3 px-6 rounded-lg font-semibold mr-2 hover:bg-gray-100 transition-colors">ğŸ“ {% trans "ØªØ¹Ø¯ÙŠÙ„" %}</a>
            <a href="{% url 'tenant_list' %}" class="bg-purple-800 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-900 transition-colors">ğŸ”™ {% trans "Ø§Ù„Ø¹ÙˆØ¯Ø©" %}</a>
        </div>
    </div>
</div>

<!-- Enhanced Statistics Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="stats-card">
        <div class="stats-number">{{ current_leases.count }}</div>
        <div class="stats-label">{% trans "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©" %}</div>
        <div class="text-xs opacity-80 mt-2">ğŸ  {% trans "Ø¹Ù‚ÙˆØ¯ Ø¬Ø§Ø±ÙŠØ©" %}</div>
    </div>
    <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <div class="stats-number">{{ lease_history.count }}</div>
        <div class="stats-label">{% trans "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚ÙˆØ¯" %}</div>
        <div class="text-xs opacity-80 mt-2">ğŸ“‹ {% trans "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„ÙƒÙ„ÙŠØ©" %}</div>
    </div>
    <div class="stats-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <div class="stats-number">{{ total_payments|floatformat:0 }}</div>
        <div class="stats-label">{% trans "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª" %} (Ø±.Ø¹)</div>
        <div class="text-xs opacity-80 mt-2">ğŸ’° {% trans "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹" %}</div>
    </div>
    <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
        <div class="stats-number">{{ tenant.phone|slice:":4" }}***</div>
        <div class="stats-label">{% trans "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" %}</div>
        <div class="text-xs opacity-80 mt-2">ğŸ“ {% trans "Ù„Ù„ØªÙˆØ§ØµÙ„" %}</div>
    </div>
</div>

<!-- Detailed Information and Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Enhanced Info Card -->
    <div class="info-card">
        <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <span class="bg-purple-100 text-purple-600 p-2 rounded-lg mr-3">ğŸ‘¤</span>
            {% trans "Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" %}
        </h3>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="text-gray-600 font-medium">{% trans "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" %}:</span>
                <span class="font-bold text-gray-800">{{ tenant.name }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="text-gray-600 font-medium">{% trans "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±" %}:</span>
                <span class="font-bold text-purple-600">{{ tenant.get_tenant_type_display }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="text-gray-600 font-medium">{% trans "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" %}:</span>
                <span class="font-bold text-blue-600">{{ tenant.phone }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="text-gray-600 font-medium">{% trans "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" %}:</span>
                <span class="font-bold text-green-600">{{ tenant.email|default:"-" }}</span>
            </div>
            {% if tenant.tenant_type == 'company' and tenant.authorized_signatory %}
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span class="text-gray-600 font-medium">{% trans "Ø§Ù„Ù…ÙÙˆØ¶ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØ¹" %}:</span>
                <span class="font-bold text-orange-600">{{ tenant.authorized_signatory }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Charts Section -->
    <div class="info-card">
        <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <span class="bg-blue-100 text-blue-600 p-2 rounded-lg mr-3">ğŸ“Š</span>
            {% trans "Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©" %}
        </h3>
        <div class="chart-container">
            <canvas id="tenantChart"></canvas>
        </div>
    </div>
</div>

<!-- Action Buttons Section -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <a href="#" onclick="generateTenantReport()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl hover:shadow-lg transition-all duration-300 text-center">
        <div class="text-3xl mb-2">ğŸ“Š</div>
        <div class="font-bold text-lg">{% trans "ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø´Ø§Ù…Ù„" %}</div>
        <div class="text-sm opacity-90">{% trans "ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ù„Ù„Ù…Ø³ØªØ£Ø¬Ø±" %}</div>
    </a>
    <a href="#" onclick="exportTenantData()" class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl hover:shadow-lg transition-all duration-300 text-center">
        <div class="text-3xl mb-2">ğŸ“„</div>
        <div class="font-bold text-lg">{% trans "ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" %}</div>
        <div class="text-sm opacity-90">{% trans "ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel/PDF" %}</div>
    </a>
    <a href="#" onclick="printTenantFile()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl hover:shadow-lg transition-all duration-300 text-center">
        <div class="text-3xl mb-2">ğŸ–¨ï¸</div>
        <div class="font-bold text-lg">{% trans "Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ù" %}</div>
        <div class="text-sm opacity-90">{% trans "Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙƒØ§Ù…Ù„Ø§Ù‹" %}</div>
    </a>
</div>

<!-- Enhanced Filter Section -->
<div class="filter-section">
    <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
        <span class="bg-gray-100 text-gray-600 p-2 rounded-lg mr-3">ğŸ”</span>
        {% trans "ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ±ØªÙŠØ¨" %}
    </h4>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <select id="statusFilter" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            <option value="">{% trans "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª" %}</option>
            <option value="active">{% trans "Ù†Ø´Ø·" %}</option>
            <option value="expired">{% trans "Ù…Ù†ØªÙ‡ÙŠ" %}</option>
            <option value="cancelled">{% trans "Ù…Ù„ØºÙŠ" %}</option>
        </select>
        <select id="sortBy" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            <option value="date_desc">{% trans "Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹" %}</option>
            <option value="date_asc">{% trans "Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹" %}</option>
            <option value="rent_desc">{% trans "Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± (Ø§Ù„Ø£Ø¹Ù„Ù‰)" %}</option>
            <option value="rent_asc">{% trans "Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± (Ø§Ù„Ø£Ù‚Ù„)" %}</option>
        </select>
        <input type="text" id="searchInput" placeholder="{% trans 'Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù‚ÙˆØ¯...' %}" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        <button onclick="applyFilters()" class="bg-purple-600 text-white p-3 rounded-lg hover:bg-purple-700 transition-colors font-semibold">
            ğŸ” {% trans "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±" %}
        </button>
    </div>
</div>

{% if current_leases %}
<div class="enhanced-table mb-6">
    <div class="table-header p-4">
        <h3 class="text-xl font-bold flex items-center">
            <span class="mr-3">ğŸ </span>
            {% trans "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©" %} ({{ current_leases.count }})
        </h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-start" id="activeLeases">
            <thead class="table-header">
                <tr>
                    <th class="p-4 text-white">{% trans "Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„ÙˆØ­Ø¯Ø©" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ" %}</th>
                    <th class="p-4 text-white">{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" %}</th>
                    <th class="p-4 text-white">{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„Ø­Ø§Ù„Ø©" %}</th>
                    <th class="p-4 text-white">{% trans "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for lease in current_leases %}
                <tr class="border-b hover:bg-purple-50 transition-colors lease-row" data-status="{{ lease.status }}" data-rent="{{ lease.monthly_rent }}" data-date="{{ lease.start_date|date:'Y-m-d' }}">
                    <td class="p-4">
                        <a href="{% url 'lease_detail' lease.pk %}" class="font-bold text-purple-600 hover:text-purple-800">
                            {{ lease.contract_number }}
                        </a>
                    </td>
                    <td class="p-4">
                        <div class="font-medium">{{ lease.unit }}</div>
                        <div class="text-sm text-gray-500">{{ lease.unit.unit_type }}</div>
                    </td>
                    <td class="p-4">
                        <div class="font-mono font-bold text-green-600">{{ lease.monthly_rent|floatformat:2 }} Ø±.Ø¹</div>
                        <div class="text-sm text-gray-500">{% trans "Ø´Ù‡Ø±ÙŠØ§Ù‹" %}</div>
                    </td>
                    <td class="p-4">
                        <div class="font-medium">{{ lease.start_date|date:"d/m/Y" }}</div>
                        <div class="text-sm text-gray-500">{{ lease.start_date|timesince }} {% trans "Ù…Ø¶Øª" %}</div>
                    </td>
                    <td class="p-4">
                        <div class="font-medium">{{ lease.end_date|date:"d/m/Y" }}</div>
                        <div class="text-sm text-gray-500">{{ lease.end_date|timeuntil }} {% trans "Ù…ØªØ¨Ù‚ÙŠØ©" %}</div>
                    </td>
                    <td class="p-4">
                        <div class="text-sm font-medium text-orange-600">
                            {% if lease.end_date %}
                                {{ lease.end_date|timeuntil }}
                            {% else %}
                                {% trans "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" %}
                            {% endif %}
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                            {{ lease.get_status_display }}
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="flex space-x-2">
                            <a href="{% url 'lease_detail' lease.pk %}" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-lg text-sm hover:bg-blue-200 transition-colors">
                                {% trans "ØªÙØ§ØµÙŠÙ„" %}
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<div class="enhanced-table">
    <div class="table-header p-4">
        <h3 class="text-xl font-bold flex items-center">
            <span class="mr-3">ğŸ“‹</span>
            {% trans "Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù‚ÙˆØ¯" %} ({{ lease_history.count }})
        </h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-start" id="leaseHistory">
            <thead class="table-header">
                <tr>
                    <th class="p-4 text-white">{% trans "Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„ÙˆØ­Ø¯Ø©" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ" %}</th>
                    <th class="p-4 text-white">{% trans "ÙØªØ±Ø© Ø§Ù„Ø¹Ù‚Ø¯" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„Ù…Ø¯Ø©" %}</th>
                    <th class="p-4 text-white">{% trans "Ø§Ù„Ø­Ø§Ù„Ø©" %}</th>
                    <th class="p-4 text-white">{% trans "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for lease in lease_history %}
                <tr class="border-b hover:bg-purple-50 transition-colors">
                    <td class="p-4">
                        <a href="{% url 'lease_detail' lease.pk %}" class="font-bold text-purple-600 hover:text-purple-800">
                            {{ lease.contract_number }}
                        </a>
                    </td>
                    <td class="p-4">
                        <div class="font-medium">{{ lease.unit }}</div>
                        <div class="text-sm text-gray-500">{{ lease.unit.unit_type }}</div>
                    </td>
                    <td class="p-4">
                        <div class="font-mono font-bold text-green-600">{{ lease.monthly_rent|floatformat:2 }} Ø±.Ø¹</div>
                    </td>
                    <td class="p-4">
                        <div class="font-medium">{{ lease.start_date|date:"d/m/Y" }}</div>
                        <div class="text-sm text-gray-500">{{ lease.end_date|date:"d/m/Y" }}</div>
                    </td>
                    <td class="p-4">
                        <div class="text-sm font-medium text-blue-600">
                            {% if lease.start_date and lease.end_date %}
                                {% with days_diff=lease.end_date|timesince:lease.start_date %}
                                    {{ days_diff }}
                                {% endwith %}
                            {% else %}
                                {% trans "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" %}
                            {% endif %}
                        </div>
                    </td>
                    <td class="p-4">
                        {% if lease.status == 'active' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                {{ lease.get_status_display }}
                            </span>
                        {% elif lease.status == 'expired' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">
                                {{ lease.get_status_display }}
                            </span>
                        {% elif lease.status == 'cancelled' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800">
                                {{ lease.get_status_display }}
                            </span>
                        {% else %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                {{ lease.get_status_display }}
                            </span>
                        {% endif %}
                    </td>
                    <td class="p-4">
                        <div class="flex space-x-2">
                            <a href="{% url 'lease_detail' lease.pk %}" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-lg text-sm hover:bg-blue-200 transition-colors">
                                {% trans "ØªÙØ§ØµÙŠÙ„" %}
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="p-8 text-center text-gray-500">
                        <div class="text-4xl mb-4">ğŸ“‹</div>
                        <div class="font-medium">{% trans "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù„Ù„Ø¹Ù‚ÙˆØ¯" %}</div>
                        <div class="text-sm">{% trans "Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ø¹Ù‚ÙˆØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ø¨Ø¹Ø¯" %}</div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
// Chart.js Configuration
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('tenantChart').getContext('2d');
    
    // Sample data - replace with actual data from backend
    const chartData = {
        labels: ['{% trans "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©" %}', '{% trans "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©" %}', '{% trans "Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ù„ØºÙŠØ©" %}'],
        datasets: [{
            data: [{{ current_leases.count }}, 
                   {% with expired_count=lease_history|length %}{{ expired_count }}{% endwith %} - {{ current_leases.count }}, 
                   0],
            backgroundColor: [
                '#10B981', // Green for active
                '#EF4444', // Red for expired  
                '#6B7280'  // Gray for cancelled
            ],
            borderWidth: 2,
            borderColor: '#ffffff'
        }]
    };

    new Chart(ctx, {
        type: 'doughnut',
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        font: {
                            size: 12,
                            family: 'Arial'
                        }
                    }
                }
            }
        }
    });
});

// Filter and Search Functions
function applyFilters() {
    const statusFilter = document.getElementById('statusFilter').value;
    const sortBy = document.getElementById('sortBy').value;
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    
    const rows = document.querySelectorAll('.lease-row');
    let visibleRows = [];
    
    rows.forEach(row => {
        let showRow = true;
        
        // Status filter
        if (statusFilter && row.dataset.status !== statusFilter) {
            showRow = false;
        }
        
        // Search filter
        if (searchInput && !row.textContent.toLowerCase().includes(searchInput)) {
            showRow = false;
        }
        
        if (showRow) {
            row.style.display = '';
            visibleRows.push(row);
        } else {
            row.style.display = 'none';
        }
    });
    
    // Sort visible rows
    if (sortBy && visibleRows.length > 0) {
        const tbody = visibleRows[0].parentNode;
        visibleRows.sort((a, b) => {
            switch(sortBy) {
                case 'date_desc':
                    return new Date(b.dataset.date) - new Date(a.dataset.date);
                case 'date_asc':
                    return new Date(a.dataset.date) - new Date(b.dataset.date);
                case 'rent_desc':
                    return parseFloat(b.dataset.rent) - parseFloat(a.dataset.rent);
                case 'rent_asc':
                    return parseFloat(a.dataset.rent) - parseFloat(b.dataset.rent);
                default:
                    return 0;
            }
        });
        
        visibleRows.forEach(row => tbody.appendChild(row));
    }
}

// Report Generation Functions
function generateTenantReport() {
    // Open comprehensive report in new window
    window.open('{% url "tenant_comprehensive_report" tenant_id=tenant.pk %}', '_blank');
}

function exportTenantData() {
    // This would export tenant data to Excel/PDF
    alert('{% trans "Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±..." %}');
    // window.open('/tenant/{{ tenant.pk }}/export/', '_blank');
}

function printTenantFile() {
    // This would open a printable version of the tenant file
    alert('{% trans "Ø³ÙŠØªÙ… ÙØªØ­ Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©..." %}');
    // window.print();
}

// Real-time search
document.getElementById('searchInput').addEventListener('input', function() {
    clearTimeout(this.searchTimeout);
    this.searchTimeout = setTimeout(applyFilters, 300);
});

// Auto-apply filters on change
document.getElementById('statusFilter').addEventListener('change', applyFilters);
document.getElementById('sortBy').addEventListener('change', applyFilters);
</script>

{% endblock %}
