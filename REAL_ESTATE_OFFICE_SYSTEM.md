# نظام إدارة المكاتب العقارية

## نظرة عامة

تم إضافة نظام شامل لإدارة المكاتب العقارية إلى نظام إدارة الإيجارات الحالي. يتيح هذا النظام للمكاتب العقارية إدارة استلام الإيجارات من المستأجرين وتوزيع العمولات لمالكي المباني حسب الاتفاقيات المبرمة بينهم.

## الميزات الجديدة

### 1. إدارة المكاتب العقارية
- **إضافة وإدارة المكاتب العقارية**: تسجيل بيانات المكاتب العقارية مع معلومات الترخيص والاتصال
- **نسبة العمولة الافتراضية**: تحديد نسبة العمولة الافتراضية لكل مكتب عقاري
- **حالة النشاط**: إمكانية تفعيل أو إلغاء تفعيل المكاتب العقارية

### 2. إدارة مالكي المباني
- **تسجيل مالكي المباني**: إضافة بيانات مالكي المباني (أفراد، شركات، جهات حكومية)
- **معلومات البنك**: تسجيل بيانات الحسابات البنكية لمالكي المباني
- **معلومات الهوية**: تسجيل أرقام الهوية أو السجل التجاري

### 3. اتفاقيات العمولة
- **إنشاء اتفاقيات العمولة**: إبرام اتفاقيات بين المكاتب العقارية ومالكي المباني
- **تحديد نسبة العمولة**: تحديد نسبة العمولة المتفق عليها لكل مبنى
- **فترات الاتفاقية**: تحديد تواريخ بدء وانتهاء الاتفاقيات
- **حالة الاتفاقية**: تتبع حالة الاتفاقيات (نشط، منتهي، ملغي)

### 4. استلام الإيجارات
- **تسجيل استلام الإيجارات**: تسجيل استلام الإيجارات من المستأجرين
- **طرق الاستلام**: دعم طرق مختلفة للاستلام (نقد، شيك، تحويل بنكي)
- **حالة الاستلام**: تتبع حالة الاستلام (تم الاستلام، في الانتظار، متأخر)
- **ربط بالعقود**: ربط استلام الإيجارات بعقود الإيجار الموجودة

### 5. توزيع العمولات
- **حساب العمولة التلقائي**: حساب العمولة بناءً على الاتفاقيات المبرمة
- **توزيع المبالغ**: توزيع المبالغ بين مالك المبنى والمكتب العقاري
- **تسجيل التوزيع**: تسجيل تاريخ وطريقة توزيع العمولات
- **تتبع الحالة**: تتبع حالة التوزيع (في الانتظار، تم التوزيع، ملغي)

## النماذج الجديدة

### RealEstateOffice (المكتب العقاري)
```python
- name: اسم المكتب العقاري
- license_number: رقم الترخيص
- contact_person: الشخص المسؤول
- phone: رقم الهاتف
- email: البريد الإلكتروني
- address: العنوان
- commission_rate: نسبة العمولة الافتراضية
- is_active: حالة النشاط
```

### BuildingOwner (مالك المبنى)
```python
- name: اسم المالك
- owner_type: نوع المالك (فرد، شركة، حكومي)
- phone: رقم الهاتف
- email: البريد الإلكتروني
- address: العنوان
- national_id: رقم الهوية/السجل التجاري
- bank_account: رقم الحساب البنكي
- bank_name: اسم البنك
- is_active: حالة النشاط
```

### CommissionAgreement (اتفاقية العمولة)
```python
- real_estate_office: المكتب العقاري
- building_owner: مالك المبنى
- building: المبنى
- agreement_number: رقم الاتفاقية
- commission_rate: نسبة العمولة
- start_date: تاريخ بدء الاتفاقية
- end_date: تاريخ انتهاء الاتفاقية
- status: حالة الاتفاقية
- notes: ملاحظات
```

### RentCollection (استلام الإيجارات)
```python
- lease: العقد
- real_estate_office: المكتب العقاري
- collection_date: تاريخ الاستلام
- amount_collected: المبلغ المستلم
- collection_method: طريقة الاستلام
- status: حالة الاستلام
- notes: ملاحظات
```

### CommissionDistribution (توزيع العمولات)
```python
- rent_collection: استلام الإيجار
- commission_agreement: اتفاقية العمولة
- building_owner: مالك المبنى
- owner_share: حصة المالك
- office_commission: عمولة المكتب
- distribution_date: تاريخ التوزيع
- status: حالة التوزيع
- payment_method: طريقة الدفع
- payment_reference: مرجع الدفع
- notes: ملاحظات
```

## الواجهات الجديدة

### 1. المكاتب العقارية
- `/dashboard/real-estate-offices/` - قائمة المكاتب العقارية
- `/dashboard/real-estate-offices/new/` - إضافة مكتب عقاري جديد
- `/dashboard/real-estate-offices/<id>/` - تفاصيل المكتب العقاري
- `/dashboard/real-estate-offices/<id>/edit/` - تعديل المكتب العقاري
- `/dashboard/real-estate-offices/<id>/delete/` - حذف المكتب العقاري

### 2. مالكو المباني
- `/dashboard/building-owners/` - قائمة مالكي المباني
- `/dashboard/building-owners/new/` - إضافة مالك مبنى جديد
- `/dashboard/building-owners/<id>/` - تفاصيل مالك المبنى
- `/dashboard/building-owners/<id>/edit/` - تعديل مالك المبنى
- `/dashboard/building-owners/<id>/delete/` - حذف مالك المبنى

### 3. اتفاقيات العمولة
- `/dashboard/commission-agreements/` - قائمة اتفاقيات العمولة
- `/dashboard/commission-agreements/new/` - إضافة اتفاقية عمولة جديدة
- `/dashboard/commission-agreements/<id>/` - تفاصيل الاتفاقية
- `/dashboard/commission-agreements/<id>/edit/` - تعديل الاتفاقية
- `/dashboard/commission-agreements/<id>/delete/` - حذف الاتفاقية

### 4. استلام الإيجارات
- `/dashboard/rent-collections/` - قائمة استلام الإيجارات
- `/dashboard/rent-collections/new/` - تسجيل استلام إيجار جديد
- `/dashboard/rent-collections/<id>/edit/` - تعديل استلام الإيجار
- `/dashboard/rent-collections/<id>/delete/` - حذف استلام الإيجار
- `/dashboard/rent-collections/<id>/create-distribution/` - إنشاء توزيع عمولة

### 5. توزيع العمولات
- `/dashboard/commission-distributions/` - قائمة توزيع العمولات
- `/dashboard/commission-distributions/new/` - تسجيل توزيع عمولة جديد
- `/dashboard/commission-distributions/<id>/` - تفاصيل التوزيع
- `/dashboard/commission-distributions/<id>/edit/` - تعديل التوزيع
- `/dashboard/commission-distributions/<id>/delete/` - حذف التوزيع

## كيفية الاستخدام

### 1. إعداد النظام
1. **إضافة مكتب عقاري**: اذهب إلى "إدارة المكاتب العقارية" > "المكاتب العقارية" > "إضافة مكتب عقاري جديد"
2. **إضافة مالك مبنى**: اذهب إلى "إدارة المكاتب العقارية" > "مالكو المباني" > "إضافة مالك مبنى جديد"
3. **إنشاء اتفاقية عمولة**: اذهب إلى "إدارة المكاتب العقارية" > "اتفاقيات العمولة" > "إضافة اتفاقية عمولة جديدة"

### 2. استلام الإيجارات
1. اذهب إلى "إدارة المكاتب العقارية" > "استلام الإيجارات" > "تسجيل استلام إيجار جديد"
2. اختر العقد والمكتب العقاري
3. أدخل المبلغ المستلم وتاريخ الاستلام
4. اختر طريقة الاستلام
5. احفظ البيانات

### 3. توزيع العمولات
1. بعد تسجيل استلام الإيجار، يمكن إنشاء توزيع عمولة تلقائياً
2. اذهب إلى "إدارة المكاتب العقارية" > "توزيع العمولات"
3. سيتم حساب العمولة تلقائياً بناءً على الاتفاقية المبرمة
4. يمكن تعديل المبالغ يدوياً إذا لزم الأمر
5. احفظ التوزيع

## الميزات المتقدمة

### 1. حساب العمولة التلقائي
- يتم حساب العمولة تلقائياً بناءً على نسبة العمولة المحددة في الاتفاقية
- حصة المالك = المبلغ المستلم - عمولة المكتب
- عمولة المكتب = المبلغ المستلم × نسبة العمولة

### 2. البحث والتصفية
- إمكانية البحث في جميع القوائم
- تصفية حسب الحالة أو النوع
- ترتيب النتائج حسب التاريخ أو الاسم

### 3. التقارير والإحصائيات
- إحصائيات المكاتب العقارية النشطة
- إجمالي المبالغ المستلمة
- إجمالي العمولات الموزعة
- عدد التوزيعات في الانتظار

### 4. التكامل مع النظام الحالي
- ربط استلام الإيجارات بعقود الإيجار الموجودة
- استخدام نفس طرق الدفع المعرفة في النظام
- دعم جميع أنواع المستأجرين والوحدات

## الأمان والصلاحيات

- جميع الواجهات محمية بصلاحية الموظفين فقط
- إمكانية الوصول من خلال لوحة الإدارة
- تسجيل جميع العمليات في سجل النظام

## الدعم الفني

للحصول على الدعم الفني أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق التطوير.

---

**ملاحظة**: هذا النظام مدمج بالكامل مع نظام إدارة الإيجارات الحالي ويستخدم نفس قاعدة البيانات والواجهات.
